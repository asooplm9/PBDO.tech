<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <title>Ú¯Ø²Ø§Ø±Ø´ Ù…Ø±Ø¯Ù…ÛŒ | PBDO</title>
  <meta name="description" content="Ø³Ø§Ù…Ø§Ù†Ù‡ Ú¯Ø²Ø§Ø±Ø´â€ŒØ¯Ù‡ÛŒ Ù…Ø±Ø¯Ù…ÛŒ Ø³Ø§Ø²Ù…Ø§Ù† Ø¯ÙØ§Ø¹ Ø²ÛŒØ³ØªÛŒ Ø¹Ù…ÙˆÙ…ÛŒ PBDO â€” Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ ØªÙ‡Ø¯ÛŒØ¯Ø§Øª Ø²ÛŒØ³ØªÛŒ Ùˆ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ú¯Ø²Ø§Ø±Ø´"/>
  <link rel="canonical" href="https://pbdo.tech/report.html"/>
  <link rel="icon" type="image/svg+xml" href="logo.svg"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="stylesheet" href="print.css" media="print"/>
  <link rel="stylesheet" href="styles.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    *{font-family:'Vazirmatn',sans-serif;}
    body{background:#0a0a0a;color:#e0e0e0;margin:0;}

    /* â”€â”€ Nav â”€â”€ */
    .site-nav{position:fixed;top:0;width:100%;z-index:200;backdrop-filter:blur(16px);-webkit-backdrop-filter:blur(16px);background:rgba(10,10,10,.88);border-bottom:1px solid rgba(0,255,136,.15);}
    .nav-inner{max-width:1200px;margin:0 auto;padding:0 20px;height:64px;display:flex;align-items:center;justify-content:space-between;}
    .nav-logo{display:flex;align-items:center;gap:8px;text-decoration:none;font-size:1.15rem;font-weight:900;color:#00ff88;text-shadow:0 0 10px #00ff8866;}
    .site-logo{width:80px;height:auto;filter:invert(1) sepia(1) saturate(5) hue-rotate(100deg);transition:transform .3s ease;vertical-align:middle;}
    .site-logo:hover{transform:scale(1.05);}
    @media(max-width:768px){.site-logo{width:50px;}}
    .nav-links{display:flex;align-items:center;gap:4px;}
    .nav-links a{color:#a0a0a0;text-decoration:none;font-size:13.5px;font-weight:500;padding:6px 12px;border-radius:6px;transition:color .2s,background .2s;}
    .nav-links a:hover{color:#00ff88;background:rgba(0,255,136,.08);}
    .nav-links a.active{color:#00ff88;background:rgba(0,255,136,.12);font-weight:700;}
    .nav-links a.nav-admin{border:1px solid #00ff8844;color:#00ff88;padding:6px 14px;}
    .nav-links a.nav-admin:hover{background:#00ff8815;}
    .hamburger{display:none;flex-direction:column;gap:5px;background:none;border:none;cursor:pointer;padding:4px;}
    .hamburger span{width:22px;height:2px;background:#00ff88;border-radius:2px;display:block;transition:all .3s;}
    @media(max-width:860px){.nav-links{display:none;}.hamburger{display:flex;}}

    /* â”€â”€ Mobile Menu â”€â”€ */
    .mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:190;}
    .mobile-overlay.open{display:block;}
    .mobile-menu{position:fixed;top:0;right:-100%;width:72%;max-width:280px;height:100%;background:#0e0e0e;border-left:1px solid #00ff8822;z-index:195;transition:right .3s ease;padding:80px 20px 20px;display:flex;flex-direction:column;gap:8px;}
    .mobile-menu.open{right:0;}
    .mobile-menu a{color:#aaa;text-decoration:none;font-size:14px;font-weight:500;padding:12px 16px;border-radius:8px;border-bottom:1px solid #ffffff08;transition:color .2s,background .2s;}
    .mobile-menu a:hover,.mobile-menu a.active{color:#00ff88;background:rgba(0,255,136,.08);}

    /* â”€â”€ Jalali Clock â”€â”€ */
    .jalali-clock{font-size:12px;color:#666;white-space:nowrap;}

    /* â”€â”€ Emergency Banner â”€â”€ */
    .emergency-banner{background:linear-gradient(135deg,#1a0000,#2a0a00);border:1px solid #ff333355;border-radius:14px;padding:20px 24px;margin-bottom:32px;display:flex;flex-wrap:wrap;align-items:center;gap:16px;}
    .emergency-numbers{display:flex;flex-wrap:wrap;gap:10px;}
    .emg-num{background:#ff333322;border:1px solid #ff3333;color:#ff6666;font-size:1.1rem;font-weight:800;padding:8px 20px;border-radius:8px;letter-spacing:2px;}
    .emg-num span{color:#fff;}

    /* â”€â”€ Tabs â”€â”€ */
    .tabs{display:flex;gap:0;border-bottom:2px solid #1e1e1e;margin-bottom:28px;}
    .tab-btn{background:none;border:none;color:#666;font-family:inherit;font-size:14px;font-weight:600;padding:12px 24px;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;transition:color .2s,border-color .2s;}
    .tab-btn:hover{color:#00ff88;}
    .tab-btn.active{color:#00ff88;border-bottom-color:#00ff88;}
    .tab-panel{display:none;}
    .tab-panel.active{display:block;}

    /* â”€â”€ Cards â”€â”€ */
    .card{background:#111;border:1px solid #00ff8818;border-radius:14px;padding:28px;}
    .section-title{font-size:1.5rem;font-weight:800;color:#00ff88;margin-bottom:4px;}
    .section-sub{color:#666;font-size:13px;margin-bottom:28px;}

    /* â”€â”€ Form â”€â”€ */
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;}
    @media(max-width:640px){.form-row{grid-template-columns:1fr;}}
    .form-group{margin-bottom:16px;}
    .form-group label{display:block;font-size:13px;font-weight:600;color:#bbb;margin-bottom:6px;}
    .form-group label .req{color:#ff5555;margin-right:2px;}
    .form-group input,.form-group select,.form-group textarea{background:#0d0d0d;border:1px solid #00ff8822;color:#e0e0e0;padding:10px 14px;border-radius:8px;width:100%;box-sizing:border-box;font-family:inherit;font-size:14px;transition:border-color .2s,box-shadow .2s;}
    .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#00ff88;box-shadow:0 0 8px #00ff8822;}
    .form-group input.error,.form-group select.error,.form-group textarea.error{border-color:#ff3333;box-shadow:0 0 8px #ff333322;}
    .field-error{color:#ff5555;font-size:12px;margin-top:4px;display:none;}
    .field-error.visible{display:block;}
    .form-group select option{background:#111;color:#e0e0e0;}

    /* â”€â”€ Anonymous Toggle â”€â”€ */
    .anon-box{display:flex;align-items:center;gap:10px;background:#0d0d0d;border:1px solid #00ff8818;border-radius:8px;padding:12px 16px;margin-bottom:20px;cursor:pointer;}
    .anon-box input[type=checkbox]{width:18px;height:18px;accent-color:#00ff88;cursor:pointer;}
    .anon-box label{color:#ccc;font-size:14px;cursor:pointer;margin:0;}

    /* â”€â”€ Urgency Radio â”€â”€ */
    .urgency-group{display:flex;flex-wrap:wrap;gap:10px;}
    .urgency-label{display:flex;align-items:center;gap:8px;padding:8px 16px;border-radius:8px;border:1px solid #333;cursor:pointer;font-size:13px;font-weight:600;transition:all .2s;}
    .urgency-label input{display:none;}
    .urgency-label.normal{color:#44cc88;}
    .urgency-label.normal:has(input:checked),.urgency-label.normal:hover{background:#44cc8820;border-color:#44cc88;}
    .urgency-label.urgent{color:#ffaa00;}
    .urgency-label.urgent:has(input:checked),.urgency-label.urgent:hover{background:#ffaa0020;border-color:#ffaa00;}
    .urgency-label.critical{color:#ff3333;}
    .urgency-label.critical:has(input:checked),.urgency-label.critical:hover{background:#ff333320;border-color:#ff3333;}

    /* â”€â”€ File Upload â”€â”€ */
    .file-upload-area{border:2px dashed #00ff8833;border-radius:10px;padding:20px;text-align:center;cursor:pointer;transition:border-color .2s;position:relative;}
    .file-upload-area:hover{border-color:#00ff8866;}
    .file-upload-area input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
    .file-preview{display:none;margin-top:12px;text-align:center;}
    .file-preview img{max-height:160px;max-width:100%;border-radius:8px;border:1px solid #00ff8833;}

    /* â”€â”€ GPS Button â”€â”€ */
    .gps-btn{display:inline-flex;align-items:center;gap:6px;background:#0d0d0d;border:1px solid #00ff8833;color:#00ff88;font-family:inherit;font-size:13px;font-weight:600;padding:9px 16px;border-radius:8px;cursor:pointer;transition:all .2s;}
    .gps-btn:hover{background:#00ff8815;border-color:#00ff88;}
    .gps-coords{font-size:12px;color:#00ff88;margin-top:6px;font-family:'Courier New',monospace;direction:ltr;text-align:left;}

    /* â”€â”€ Captcha â”€â”€ */
    .captcha-box{background:#0d0d0d;border:1px solid #00ff8822;border-radius:10px;padding:16px 20px;display:flex;flex-wrap:wrap;align-items:center;gap:12px;}
    .captcha-question{color:#ccc;font-size:14px;}
    .captcha-nums{color:#00ff88;font-weight:800;font-size:1.1rem;}
    .captcha-box input{width:90px;flex-shrink:0;}

    /* â”€â”€ Submit Btn â”€â”€ */
    .submit-btn{width:100%;padding:14px;background:linear-gradient(135deg,#00ff88,#00cc66);color:#000;font-family:inherit;font-size:1rem;font-weight:800;border:none;border-radius:10px;cursor:pointer;transition:all .3s;margin-top:8px;}
    .submit-btn:hover{box-shadow:0 0 24px #00ff8866;transform:translateY(-1px);}
    .submit-btn:active{transform:translateY(0);}
    .submit-btn:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none;}

    /* â”€â”€ Success Card â”€â”€ */
    .success-card{display:none;background:linear-gradient(135deg,#001a0d,#002a14);border:1px solid #00ff8844;border-radius:14px;padding:32px;text-align:center;}
    .success-card.visible{display:block;}
    .tracking-code{font-family:'Courier New',monospace;font-size:2rem;font-weight:900;color:#00ff88;letter-spacing:4px;direction:ltr;text-align:center;background:#00ff8815;border:2px solid #00ff8844;border-radius:10px;padding:12px 24px;display:inline-block;margin:12px 0;}

    /* â”€â”€ Track Form â”€â”€ */
    .track-search{display:flex;gap:10px;margin-bottom:24px;}
    .track-search input{flex:1;}
    .track-search button{background:linear-gradient(135deg,#00ff88,#00cc66);color:#000;border:none;padding:10px 22px;border-radius:8px;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;white-space:nowrap;transition:all .3s;}
    .track-search button:hover{box-shadow:0 0 16px #00ff8855;}

    /* â”€â”€ Status Timeline â”€â”€ */
    .status-timeline{display:flex;flex-direction:column;gap:0;position:relative;padding-right:20px;}
    .status-timeline::before{content:'';position:absolute;right:7px;top:8px;bottom:8px;width:2px;background:#1e1e1e;}
    .timeline-step{display:flex;align-items:flex-start;gap:16px;padding-bottom:20px;position:relative;}
    .timeline-step:last-child{padding-bottom:0;}
    .step-dot{width:16px;height:16px;border-radius:50%;border:2px solid #333;background:#0a0a0a;flex-shrink:0;margin-top:2px;position:relative;z-index:1;}
    .step-dot.done{background:#00ff88;border-color:#00ff88;box-shadow:0 0 8px #00ff8866;}
    .step-dot.current{background:#ffaa00;border-color:#ffaa00;box-shadow:0 0 8px #ffaa0066;animation:pulse-dot 1.5s infinite;}
    @keyframes pulse-dot{0%,100%{box-shadow:0 0 8px #ffaa0066;}50%{box-shadow:0 0 16px #ffaa00aa;}}
    .step-info{flex:1;}
    .step-label{font-size:13px;font-weight:700;color:#888;}
    .step-label.done{color:#00ff88;}
    .step-label.current{color:#ffaa00;}
    .step-date{font-size:11px;color:#555;margin-top:2px;}

    /* â”€â”€ Report Detail Card â”€â”€ */
    .report-detail{background:#0d0d0d;border:1px solid #00ff8822;border-radius:12px;padding:20px;margin-bottom:16px;}
    .detail-row{display:flex;gap:8px;margin-bottom:8px;font-size:13px;}
    .detail-label{color:#666;min-width:140px;flex-shrink:0;}
    .detail-value{color:#ccc;font-weight:500;}

    /* â”€â”€ Status Badge â”€â”€ */
    .badge{display:inline-block;padding:3px 12px;border-radius:20px;font-size:11px;font-weight:700;}
    .badge-green{background:#00ff8820;color:#00ff88;border:1px solid #00ff8840;}
    .badge-yellow{background:#ffaa0020;color:#ffaa00;border:1px solid #ffaa0040;}
    .badge-red{background:#ff333320;color:#ff3333;border:1px solid #ff333340;}
    .badge-blue{background:#3399ff20;color:#3399ff;border:1px solid #3399ff40;}

    /* â”€â”€ Admin Notes â”€â”€ */
    .admin-notes{background:#0d0d0d;border-right:3px solid #00ff88;border-radius:0 8px 8px 0;padding:12px 16px;font-size:13px;color:#aaa;margin-top:16px;}

    /* â”€â”€ Not Found â”€â”€ */
    .not-found{text-align:center;padding:40px 20px;color:#555;}
    .not-found .icon{font-size:3rem;margin-bottom:12px;}

    /* â”€â”€ Footer â”€â”€ */
    footer{background:#060606;border-top:1px solid #00ff8815;padding:40px 20px 24px;margin-top:60px;}
    .footer-inner{max-width:1200px;margin:0 auto;}
    .footer-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:32px;margin-bottom:32px;}
    .footer-col h4{color:#00ff88;font-size:13px;font-weight:700;margin-bottom:12px;text-transform:uppercase;letter-spacing:1px;}
    .footer-col a{display:block;color:#555;text-decoration:none;font-size:13px;margin-bottom:6px;transition:color .2s;}
    .footer-col a:hover{color:#00ff88;}
    .footer-bottom{border-top:1px solid #00ff8812;padding-top:20px;text-align:center;color:#444;font-size:12px;}

    /* â”€â”€ Scrollbar â”€â”€ */
    ::-webkit-scrollbar{width:5px;}
    ::-webkit-scrollbar-track{background:#0a0a0a;}
    ::-webkit-scrollbar-thumb{background:#00ff8840;border-radius:4px;}

    /* â”€â”€ Skip link â”€â”€ */
    .skip-link{position:absolute;top:-40px;right:0;background:#00ff88;color:#000;padding:8px 16px;font-weight:700;border-radius:0 0 0 8px;transition:top .2s;z-index:9999;}
    .skip-link:focus{top:0;}
  </style>
</head>
<body>

<a href="#main" class="skip-link">Ø±ÙØªÙ† Ø¨Ù‡ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ</a>

<!-- Mobile overlay -->
<div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()" aria-hidden="true"></div>

<!-- Mobile menu -->
<nav class="mobile-menu" id="mobileMenu" role="navigation" aria-label="Ù…Ù†ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„">
  <a href="index.html">Ø®Ø§Ù†Ù‡</a>
  <a href="monitoring.html">Ù¾Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡</a>
  <a href="radar.html">Ø±Ø§Ø¯Ø§Ø±</a>
  <a href="report.html" class="active">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø±Ø¯Ù…ÛŒ</a>
  <a href="about.html">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a>
  <a href="contact.html">ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</a>
  <a href="admin.html" style="color:#00ff88;border:1px solid #00ff8433;margin-top:8px;border-radius:8px;">ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±Ø§Ù†</a>
</nav>

<!-- Main nav -->
<nav class="site-nav" role="navigation" aria-label="Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ">
  <div class="nav-inner">
    <a href="index.html" class="nav-logo" aria-label="ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ PBDO">
      <img src="logo.png" alt="Ù„ÙˆÚ¯ÙˆÛŒ Ø³Ø§Ø²Ù…Ø§Ù† Ø¯ÙØ§Ø¹ Ø²ÛŒØ³ØªÛŒ Ø¹Ù…ÙˆÙ…ÛŒ" class="site-logo">ğŸ›¡ï¸ <span>PBDO</span>
      <span style="font-size:11px;font-weight:400;color:#555;padding-right:4px;">Ø³Ø§Ø²Ù…Ø§Ù† Ø¯ÙØ§Ø¹ Ø²ÛŒØ³ØªÛŒ Ø¹Ù…ÙˆÙ…ÛŒ</span>
    </a>
    <div class="nav-links" role="menubar">
      <a href="index.html" role="menuitem">Ø®Ø§Ù†Ù‡</a>
      <a href="monitoring.html" role="menuitem">Ù¾Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡</a>
      <a href="radar.html" role="menuitem">Ø±Ø§Ø¯Ø§Ø±</a>
      <a href="report.html" class="active" role="menuitem" aria-current="page">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø±Ø¯Ù…ÛŒ</a>
      <a href="about.html" role="menuitem">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a>
      <a href="contact.html" role="menuitem">ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</a>
      <a href="admin.html" class="nav-admin" role="menuitem">ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±Ø§Ù†</a>
    </div>
    <div style="display:flex;align-items:center;gap:16px;">
      <span class="jalali-clock" id="jalaliClock" aria-live="polite" aria-label="ØªØ§Ø±ÛŒØ® Ùˆ Ø³Ø§Ø¹Øª"></span>
      <button class="hamburger" id="hamburgerBtn" onclick="openMobileMenu()" aria-label="Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ù†Ùˆ" aria-expanded="false" aria-controls="mobileMenu">
        <span></span><span></span><span></span>
      </button>
    </div>
  </div>
</nav>

<main id="main" style="max-width:900px;margin:0 auto;padding:96px 20px 40px;">

  <!-- Page Header -->
  <div style="margin-bottom:32px;">
    <div style="display:inline-flex;align-items:center;gap:8px;background:#00ff8812;border:1px solid #00ff8830;color:#00ff88;font-size:12px;font-weight:700;padding:4px 14px;border-radius:20px;margin-bottom:12px;">
      <span>ğŸ“‹</span> Ø³Ø§Ù…Ø§Ù†Ù‡ Ú¯Ø²Ø§Ø±Ø´â€ŒØ¯Ù‡ÛŒ Ù…Ø±Ø¯Ù…ÛŒ
    </div>
    <h1 style="font-size:2rem;font-weight:900;color:#e8e8e8;margin:0 0 8px;">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø±Ø¯Ù…ÛŒ ØªÙ‡Ø¯ÛŒØ¯Ø§Øª Ø²ÛŒØ³ØªÛŒ</h1>
    <p style="color:#666;font-size:14px;line-height:1.8;">Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù…ÙˆØ§Ø±Ø¯ Ù…Ø´Ú©ÙˆÚ©ØŒ Ø¢Ù„ÙˆØ¯Ú¯ÛŒâ€ŒÙ‡Ø§ Ùˆ ØªÙ‡Ø¯ÛŒØ¯Ø§Øª Ø²ÛŒØ³ØªÛŒ Ø±Ø§ Ø¨Ù‡ Ø³Ø§Ø²Ù…Ø§Ù† PBDO Ú¯Ø²Ø§Ø±Ø´ Ø¯Ù‡ÛŒØ¯. ØªÙ…Ø§Ù…ÛŒ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ù…Ø­Ø±Ù…Ø§Ù†Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>
  </div>

  <!-- Emergency Banner -->
  <div class="emergency-banner" role="alert" aria-label="Ø®Ø· Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ">
    <div style="font-size:1.4rem;" aria-hidden="true">ğŸš¨</div>
    <div>
      <div style="font-size:13px;font-weight:700;color:#ff6666;margin-bottom:6px;">Ø®Ø· Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ â€” Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø±Ø¯ ÙÙˆØ±ÛŒ Ø¨Ù„Ø§ÙØ§ØµÙ„Ù‡ Ø¨Ø§ Ø§ÙˆØ±Ú˜Ø§Ù†Ø³ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯</div>
      <div class="emergency-numbers">
        <div class="emg-num">Ø§ÙˆØ±Ú˜Ø§Ù†Ø³ <span>Û±Û±Ûµ</span></div>
        <div class="emg-num">Ù¾Ù„ÛŒØ³ <span>Û±Û±Û°</span></div>
        <div class="emg-num">Ø¢ØªØ´â€ŒÙ†Ø´Ø§Ù†ÛŒ <span>Û±Û²Ûµ</span></div>
        <div class="emg-num">Ø§ÙˆØ±Ú˜Ø§Ù†Ø³ Ø§Ø¬ØªÙ…Ø§Ø¹ÛŒ <span>Û±Û²Û³</span></div>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs" role="tablist" aria-label="Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ ØµÙØ­Ù‡">
    <button class="tab-btn active" id="tab-new" role="tab" aria-selected="true" aria-controls="panel-new" onclick="switchTab('new')">ğŸ“ Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø¯ÛŒØ¯</button>
    <button class="tab-btn" id="tab-track" role="tab" aria-selected="false" aria-controls="panel-track" onclick="switchTab('track')">ğŸ” Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ú¯Ø²Ø§Ø±Ø´</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 1 â€” NEW REPORT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-panel active" id="panel-new" role="tabpanel" aria-labelledby="tab-new">

    <!-- Success message (hidden initially) -->
    <div class="success-card" id="successCard" role="status" aria-live="polite">
      <div style="font-size:3rem;margin-bottom:12px;">âœ…</div>
      <h2 style="font-size:1.4rem;font-weight:800;color:#00ff88;margin-bottom:8px;">Ú¯Ø²Ø§Ø±Ø´ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯</h2>
      <p style="color:#888;font-size:13px;margin-bottom:20px;">Ú¯Ø²Ø§Ø±Ø´ Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ø¯Ø± ØµÙ Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØª. Ú©Ø§Ø±Ø´Ù†Ø§Ø³Ø§Ù† PBDO Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø¢Ù† Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ú©Ø±Ø¯.</p>
      <div style="margin-bottom:6px;font-size:13px;color:#aaa;">Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø´Ù…Ø§:</div>
      <div class="tracking-code" id="successCode" aria-label="Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ">â€”</div>
      <p style="color:#ff9900;font-size:12px;margin-top:8px;">âš ï¸ Ø§ÛŒÙ† Ú©Ø¯ Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ú¯Ø²Ø§Ø±Ø´ Ù†ÛŒØ§Ø² Ø®ÙˆØ§Ù‡ÛŒØ¯ Ø¯Ø§Ø´Øª.</p>
      <button onclick="resetForm()" style="margin-top:20px;background:#00ff8820;border:1px solid #00ff8844;color:#00ff88;font-family:inherit;font-size:13px;font-weight:700;padding:10px 24px;border-radius:8px;cursor:pointer;">â• Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ø¬Ø¯ÛŒØ¯</button>
    </div>

    <!-- Report form -->
    <div class="card" id="reportFormCard">
      <h2 class="section-title">ğŸ“‹ ÙØ±Ù… Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´</h2>
      <p class="section-sub">Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø¨Ø§ Ø¯Ù‚Øª Ùˆ ØµØ§Ø¯Ù‚Ø§Ù†Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>

      <form id="reportForm" novalidate onsubmit="submitReport(event)">

        <!-- Anonymous toggle -->
        <div class="anon-box" onclick="toggleAnon()">
          <input type="checkbox" id="anonCheck" aria-label="Ø§Ø±Ø³Ø§Ù„ Ù†Ø§Ø´Ù†Ø§Ø³"/>
          <label for="anonCheck">ğŸ•µï¸ Ú¯Ø²Ø§Ø±Ø´ Ù†Ø§Ø´Ù†Ø§Ø³ â€” Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ Ù…Ù† Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù†Ø´ÙˆØ¯</label>
        </div>

        <!-- Personal info (hidden when anon) -->
        <div id="personalFields">
          <div class="form-row">
            <div class="form-group">
              <label for="fullName">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</label>
              <input type="text" id="fullName" placeholder="Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯" autocomplete="name"/>
              <div class="field-error" id="err-fullName"></div>
            </div>
            <div class="form-group">
              <label for="phone">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</label>
              <input type="tel" id="phone" placeholder="09xxxxxxxxx" dir="ltr" autocomplete="tel"/>
              <div class="field-error" id="err-phone"></div>
            </div>
          </div>
          <div class="form-group">
            <label for="email">Ø§ÛŒÙ…ÛŒÙ„</label>
            <input type="email" id="email" placeholder="example@email.com" dir="ltr" autocomplete="email"/>
            <div class="field-error" id="err-email"></div>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid #1a1a1a;margin:4px 0 20px;"/>

        <!-- Province & City -->
        <div class="form-row">
          <div class="form-group">
            <label for="province"><span class="req">*</span> Ø§Ø³ØªØ§Ù†</label>
            <select id="province" onchange="updateCities()" aria-required="true">
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø³ØªØ§Ù†...</option>
              <option>Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø´Ø±Ù‚ÛŒ</option>
              <option>Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† ØºØ±Ø¨ÛŒ</option>
              <option>Ø§Ø±Ø¯Ø¨ÛŒÙ„</option>
              <option>Ø§ØµÙÙ‡Ø§Ù†</option>
              <option>Ø§Ù„Ø¨Ø±Ø²</option>
              <option>Ø§ÛŒÙ„Ø§Ù…</option>
              <option>Ø¨ÙˆØ´Ù‡Ø±</option>
              <option>ØªÙ‡Ø±Ø§Ù†</option>
              <option>Ú†Ù‡Ø§Ø±Ù…Ø­Ø§Ù„ Ùˆ Ø¨Ø®ØªÛŒØ§Ø±ÛŒ</option>
              <option>Ø®Ø±Ø§Ø³Ø§Ù† Ø¬Ù†ÙˆØ¨ÛŒ</option>
              <option>Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ</option>
              <option>Ø®Ø±Ø§Ø³Ø§Ù† Ø´Ù…Ø§Ù„ÛŒ</option>
              <option>Ø®ÙˆØ²Ø³ØªØ§Ù†</option>
              <option>Ø²Ù†Ø¬Ø§Ù†</option>
              <option>Ø³Ù…Ù†Ø§Ù†</option>
              <option>Ø³ÛŒØ³ØªØ§Ù† Ùˆ Ø¨Ù„ÙˆÚ†Ø³ØªØ§Ù†</option>
              <option>ÙØ§Ø±Ø³</option>
              <option>Ù‚Ø²ÙˆÛŒÙ†</option>
              <option>Ù‚Ù…</option>
              <option>Ú©Ø±Ø¯Ø³ØªØ§Ù†</option>
              <option>Ú©Ø±Ù…Ø§Ù†</option>
              <option>Ú©Ø±Ù…Ø§Ù†Ø´Ø§Ù‡</option>
              <option>Ú©Ù‡Ú¯ÛŒÙ„ÙˆÛŒÙ‡ Ùˆ Ø¨ÙˆÛŒØ±Ø§Ø­Ù…Ø¯</option>
              <option>Ú¯Ù„Ø³ØªØ§Ù†</option>
              <option>Ú¯ÛŒÙ„Ø§Ù†</option>
              <option>Ù„Ø±Ø³ØªØ§Ù†</option>
              <option>Ù…Ø§Ø²Ù†Ø¯Ø±Ø§Ù†</option>
              <option>Ù…Ø±Ú©Ø²ÛŒ</option>
              <option>Ù‡Ø±Ù…Ø²Ú¯Ø§Ù†</option>
              <option>Ù‡Ù…Ø¯Ø§Ù†</option>
              <option>ÛŒØ²Ø¯</option>
            </select>
            <div class="field-error" id="err-province"></div>
          </div>
          <div class="form-group">
            <label for="city">Ø´Ù‡Ø± / Ø±ÙˆØ³ØªØ§</label>
            <input type="text" id="city" placeholder="Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§" list="cityList"/>
            <datalist id="cityList"></datalist>
          </div>
        </div>

        <!-- Threat type -->
        <div class="form-group">
          <label for="threatType"><span class="req">*</span> Ù†ÙˆØ¹ ØªÙ‡Ø¯ÛŒØ¯</label>
          <select id="threatType" aria-required="true">
            <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ ØªÙ‡Ø¯ÛŒØ¯...</option>
            <option value="bio-attack">âš ï¸ Ø­Ù…Ù„Ù‡ Ø¨ÛŒÙˆÙ„ÙˆÚ˜ÛŒÚ©ÛŒ</option>
            <option value="water-cont">ğŸ’§ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ø¢Ø¨</option>
            <option value="air-cont">ğŸŒ«ï¸ Ø¢Ù„ÙˆØ¯Ú¯ÛŒ Ù‡ÙˆØ§</option>
            <option value="unknown-disease">ğŸ¦  Ø¨ÛŒÙ…Ø§Ø±ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡</option>
            <option value="suspicious-material">ğŸ§ª Ù…ÙˆØ§Ø¯ Ù…Ø´Ú©ÙˆÚ©</option>
            <option value="other">ğŸ“Œ Ø³Ø§ÛŒØ±</option>
          </select>
          <div class="field-error" id="err-threatType"></div>
        </div>

        <!-- Urgency -->
        <div class="form-group">
          <label><span class="req">*</span> Ø³Ø·Ø­ ÙÙˆØ±ÛŒØª</label>
          <div class="urgency-group" role="group" aria-label="Ø³Ø·Ø­ ÙÙˆØ±ÛŒØª">
            <label class="urgency-label normal">
              <input type="radio" name="urgency" value="normal" checked aria-label="Ø¹Ø§Ø¯ÛŒ"/> âœ… Ø¹Ø§Ø¯ÛŒ
            </label>
            <label class="urgency-label urgent">
              <input type="radio" name="urgency" value="urgent" aria-label="ÙÙˆØ±ÛŒ"/> âš¡ ÙÙˆØ±ÛŒ
            </label>
            <label class="urgency-label critical">
              <input type="radio" name="urgency" value="critical" aria-label="Ø¨Ø­Ø±Ø§Ù†ÛŒ"/> ğŸš¨ Ø¨Ø­Ø±Ø§Ù†ÛŒ
            </label>
          </div>
        </div>

        <!-- Date of observation -->
        <div class="form-group">
          <label for="obsDate">ØªØ§Ø±ÛŒØ® Ù…Ø´Ø§Ù‡Ø¯Ù‡</label>
          <input type="date" id="obsDate" dir="ltr" style="width:100%;"/>
        </div>

        <!-- Description -->
        <div class="form-group">
          <label for="description"><span class="req">*</span> ØªÙˆØ¶ÛŒØ­Ø§Øª <span style="color:#555;font-weight:400;">(Ø­Ø¯Ø§Ù‚Ù„ Û²Û° Ú©Ø§Ø±Ø§Ú©ØªØ±)</span></label>
          <textarea id="description" rows="5" placeholder="Ù„Ø·ÙØ§Ù‹ Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù…Ù„ Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø´Ø±Ø­ Ø¯Ù‡ÛŒØ¯. Ù…Ø­Ù„ Ø¯Ù‚ÛŒÙ‚ØŒ Ø²Ù…Ø§Ù†ØŒ Ø¹Ù„Ø§Ø¦Ù… Ù…Ø´Ø§Ù‡Ø¯Ù‡â€ŒØ´Ø¯Ù‡ Ùˆ Ù‡Ø± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø±ØªØ¨Ø· Ø¯ÛŒÚ¯Ø±ÛŒ Ø±Ø§ Ø°Ú©Ø± Ú©Ù†ÛŒØ¯..." aria-required="true" oninput="liveValidateDesc()"></textarea>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:4px;">
            <div class="field-error" id="err-description" style="flex:1;"></div>
            <span id="descCount" style="font-size:11px;color:#555;">0 / 1000</span>
          </div>
        </div>

        <!-- File upload -->
        <div class="form-group">
          <label>Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± / Ù…Ø¯Ø±Ú©</label>
          <div class="file-upload-area" id="fileUploadArea">
            <input type="file" id="fileInput" accept="image/*,.pdf" aria-label="Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„" onchange="handleFileUpload(event)"/>
            <div id="fileUploadText">
              <div style="font-size:1.5rem;margin-bottom:6px;">ğŸ“</div>
              <div style="color:#666;font-size:13px;">Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ú©Ø´ÛŒØ¯ Ùˆ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯</div>
              <div style="color:#444;font-size:11px;margin-top:4px;">ØªØµÙˆÛŒØ± ÛŒØ§ PDFØŒ Ø­Ø¯Ø§Ú©Ø«Ø± Ûµ Ù…Ú¯Ø§Ø¨Ø§ÛŒØª</div>
            </div>
          </div>
          <div class="file-preview" id="filePreview">
            <img id="filePreviewImg" src="" alt="Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ ÙØ§ÛŒÙ„"/>
            <div id="filePreviewName" style="font-size:12px;color:#666;margin-top:6px;"></div>
            <button type="button" onclick="clearFile()" style="background:none;border:1px solid #ff333344;color:#ff5555;font-family:inherit;font-size:12px;padding:4px 12px;border-radius:6px;cursor:pointer;margin-top:6px;">Ã— Ø­Ø°Ù ÙØ§ÛŒÙ„</button>
          </div>
        </div>

        <!-- GPS -->
        <div class="form-group">
          <label>Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</label>
          <div>
            <button type="button" class="gps-btn" id="getLocation" onclick="getGPS()">
              <span>ğŸ“</span> Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†
            </button>
            <div class="gps-coords" id="gpsCoords" style="display:none;" aria-live="polite"></div>
            <input type="hidden" id="gpsLat"/>
            <input type="hidden" id="gpsLng"/>
          </div>
        </div>

        <!-- Math Captcha -->
        <div class="form-group">
          <label><span class="req">*</span> ØªØ£ÛŒÛŒØ¯ Ø±ÛŒØ§Ø¶ÛŒ</label>
          <div class="captcha-box">
            <span class="captcha-question">Ù„Ø·ÙØ§Ù‹ Ø­Ø§ØµÙ„</span>
            <span class="captcha-nums" id="captchaQuestion" aria-live="polite">ØŸ + ØŸ</span>
            <span class="captcha-question">Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</span>
            <input type="number" id="captchaAnswer" placeholder="Ù¾Ø§Ø³Ø®" style="width:90px;flex-shrink:0;" aria-label="Ù¾Ø§Ø³Ø® Ù…Ø¹Ø§Ø¯Ù„Ù‡ Ø±ÛŒØ§Ø¶ÛŒ" min="0"/>
          </div>
          <div class="field-error" id="err-captcha"></div>
        </div>

        <!-- Submit -->
        <button type="submit" class="submit-btn" id="submitBtn">ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´</button>

      </form>
    </div>
  </div><!-- /panel-new -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TAB 2 â€” TRACK REPORT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-panel" id="panel-track" role="tabpanel" aria-labelledby="tab-track">
    <div class="card">
      <h2 class="section-title">ğŸ” Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ú¯Ø²Ø§Ø±Ø´</h2>
      <p class="section-sub">Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ Ù¾Ø³ Ø§Ø² Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p>

      <div class="track-search">
        <input type="text" id="trackingInput" placeholder="Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ (Ù…Ø«Ø§Ù„: A3X7B2QR)" dir="ltr" aria-label="Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ" maxlength="8" oninput="this.value=this.value.toUpperCase()"/>
        <button onclick="trackReport()" aria-label="Ø¬Ø³ØªØ¬ÙˆÛŒ Ú¯Ø²Ø§Ø±Ø´">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</button>
      </div>

      <div id="trackResult" aria-live="polite"></div>
    </div>
  </div><!-- /panel-track -->

</main>

<!-- Footer -->
<footer role="contentinfo">
  <div class="footer-inner">
    <div class="footer-grid">
      <div class="footer-col">
        <h4>ğŸ›¡ï¸ PBDO</h4>
        <p style="color:#444;font-size:12px;line-height:1.8;margin-top:4px;">Ø³Ø§Ø²Ù…Ø§Ù† Ø¯ÙØ§Ø¹ Ø²ÛŒØ³ØªÛŒ Ø¹Ù…ÙˆÙ…ÛŒ<br/>Ø¬Ù…Ù‡ÙˆØ±ÛŒ Ø§Ø³Ù„Ø§Ù…ÛŒ Ø§ÛŒØ±Ø§Ù†</p>
      </div>
      <div class="footer-col">
        <h4>ØµÙØ­Ø§Øª Ø§ØµÙ„ÛŒ</h4>
        <a href="index.html">Ø®Ø§Ù†Ù‡</a>
        <a href="monitoring.html">Ù¾Ø§ÛŒØ´ Ø²Ù†Ø¯Ù‡</a>
        <a href="radar.html">Ø±Ø§Ø¯Ø§Ø± ØªÙ‡Ø¯ÛŒØ¯Ø§Øª</a>
        <a href="report.html">Ú¯Ø²Ø§Ø±Ø´ Ù…Ø±Ø¯Ù…ÛŒ</a>
      </div>
      <div class="footer-col">
        <h4>Ø³Ø§Ø²Ù…Ø§Ù†</h4>
        <a href="about.html">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a>
        <a href="contact.html">ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</a>
        <a href="faq.html">Ø³Ø¤Ø§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„</a>
        <a href="status.html">ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆÛŒØ³</a>
      </div>
      <div class="footer-col">
        <h4>Ø­Ù‚ÙˆÙ‚ÛŒ</h4>
        <a href="privacy.html">Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ</a>
        <a href="terms.html">Ø´Ø±Ø§ÛŒØ· Ø§Ø³ØªÙØ§Ø¯Ù‡</a>
        <a href="admin.html">ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±Ø§Ù†</a>
      </div>
    </div>
    <div class="footer-bottom">
      <p>Â© Û±Û´Û°Û´ Ø³Ø§Ø²Ù…Ø§Ù† Ø¯ÙØ§Ø¹ Ø²ÛŒØ³ØªÛŒ Ø¹Ù…ÙˆÙ…ÛŒ PBDO â€” ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª</p>
      <p style="margin-top:6px;color:#333;">Ø¯Ø± Ù…ÙˆØ§Ø±Ø¯ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ: Ø§ÙˆØ±Ú˜Ø§Ù†Ø³ Û±Û±Ûµ | Ù¾Ù„ÛŒØ³ Û±Û±Û°</p>
    </div>
  </div>
</footer>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function sanitizeHTML(str) {
  const el = document.createElement('div');
  el.textContent = String(str);
  return el.innerHTML;
}

/* â”€â”€ Jalali converter (standalone algorithm) â”€â”€ */
function toJalali(gy, gm, gd) {
  const g_d_no = [0,31,29,31,30,31,30,31,31,30,31,30,31];
  const j_d_no = [0,31,31,31,31,31,31,30,30,30,30,30,29];
  function isLeapG(y){return (y%4===0&&y%100!==0)||y%400===0;}
  if(gm<1||gm>12||gd<1||gd>g_d_no[gm]||(gm===2&&!isLeapG(gy)&&gd===29))return null;
  let jy,jm,jd,g_y,j_y1,gy2,days;
  gy2=gm>2?gy+1:gy;
  days=355666+(365*gy)+(~~((gy2+3)/4))-(~~((gy2+99)/100))+(~~((gy2+399)/400));
  for(let i=1;i<gm;i++)days+=g_d_no[i];
  if(isLeapG(gy)&&gm>2)days++;
  days+=gd;
  jy=~~((days-22)/365.25);
  j_y1=jy;
  let jDays=22+(365*jy)+(~~((jy-474+474*179)/2820*683/2820)*683);
  if(days<jDays){jy--;jDays=22+(365*jy)+(~~((jy-474+474*179)/2820*683/2820)*683);}
  jm=0;
  let rem=days-jDays+1;
  for(let i=1;i<=12;i++){let dc=j_d_no[i];if(i===12)dc=days-jDays-364+(~~((jy-474+474*179)/2820)*683);if(rem<=dc){jm=i;jd=rem;break;}rem-=dc;}
  return{y:jy,m:jm,d:jd};
}

const JALALI_MONTHS = ['ÙØ±ÙˆØ±Ø¯ÛŒÙ†','Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª','Ø®Ø±Ø¯Ø§Ø¯','ØªÛŒØ±','Ù…Ø±Ø¯Ø§Ø¯','Ø´Ù‡Ø±ÛŒÙˆØ±','Ù…Ù‡Ø±','Ø¢Ø¨Ø§Ù†','Ø¢Ø°Ø±','Ø¯ÛŒ','Ø¨Ù‡Ù…Ù†','Ø§Ø³ÙÙ†Ø¯'];
const JALALI_DAYS   = ['ÛŒÚ©Ø´Ù†Ø¨Ù‡','Ø¯ÙˆØ´Ù†Ø¨Ù‡','Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡','Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡','Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡','Ø¬Ù…Ø¹Ù‡','Ø´Ù†Ø¨Ù‡'];

function formatJalali(date) {
  const j = toJalali(date.getFullYear(), date.getMonth()+1, date.getDate());
  if (!j) return '';
  const dayName = JALALI_DAYS[date.getDay()];
  const hh = String(date.getHours()).padStart(2,'0');
  const mm = String(date.getMinutes()).padStart(2,'0');
  return `${dayName}ØŒ ${j.d} ${JALALI_MONTHS[j.m-1]} ${j.y} â€” ${hh}:${mm}`;
}

function updateClock() {
  const el = document.getElementById('jalaliClock');
  if (el) el.textContent = formatJalali(new Date());
}
updateClock();
setInterval(updateClock, 30000);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MOBILE MENU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openMobileMenu() {
  document.getElementById('mobileMenu').classList.add('open');
  document.getElementById('mobileOverlay').classList.add('open');
  document.getElementById('hamburgerBtn').setAttribute('aria-expanded','true');
}
function closeMobileMenu() {
  document.getElementById('mobileMenu').classList.remove('open');
  document.getElementById('mobileOverlay').classList.remove('open');
  document.getElementById('hamburgerBtn').setAttribute('aria-expanded','false');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function switchTab(name) {
  document.querySelectorAll('.tab-btn').forEach(b => {
    b.classList.remove('active');
    b.setAttribute('aria-selected','false');
  });
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.getElementById('tab-'+name).classList.add('active');
  document.getElementById('tab-'+name).setAttribute('aria-selected','true');
  document.getElementById('panel-'+name).classList.add('active');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANONYMOUS TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleAnon() {
  const cb = document.getElementById('anonCheck');
  const fields = document.getElementById('personalFields');
  cb.checked = !cb.checked;
  fields.style.display = cb.checked ? 'none' : 'block';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROVINCE â†’ CITIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PROVINCE_CITIES = {
  'ØªÙ‡Ø±Ø§Ù†':                    ['ØªÙ‡Ø±Ø§Ù†','Ø´Ù‡Ø±ÛŒØ§Ø±','Ø±ÛŒ','Ø§Ø³Ù„Ø§Ù…Ø´Ù‡Ø±','Ù¾Ø§Ú©Ø¯Ø´Øª','Ø¯Ù…Ø§ÙˆÙ†Ø¯','ÙÛŒØ±ÙˆØ²Ú©ÙˆÙ‡','ÙˆØ±Ø§Ù…ÛŒÙ†','Ø±Ø¨Ø§Ø·â€ŒÚ©Ø±ÛŒÙ…'],
  'Ø§ØµÙÙ‡Ø§Ù†':                   ['Ø§ØµÙÙ‡Ø§Ù†','Ú©Ø§Ø´Ø§Ù†','Ø®Ù…ÛŒÙ†ÛŒâ€ŒØ´Ù‡Ø±','Ù†Ø¬Ùâ€ŒØ¢Ø¨Ø§Ø¯','Ø´Ø§Ù‡ÛŒÙ†â€ŒØ´Ù‡Ø±','Ø²Ø±ÛŒÙ†â€ŒØ´Ù‡Ø±','ÙÙ„Ø§ÙˆØ±Ø¬Ø§Ù†'],
  'Ø®ÙˆØ²Ø³ØªØ§Ù†':                  ['Ø§Ù‡ÙˆØ§Ø²','Ø¢Ø¨Ø§Ø¯Ø§Ù†','Ø®Ø±Ù…Ø´Ù‡Ø±','Ø¯Ø²ÙÙˆÙ„','Ù…Ø§Ù‡Ø´Ù‡Ø±','Ø§Ù†Ø¯ÛŒÙ…Ø´Ú©','Ø¨Ù‡Ø¨Ù‡Ø§Ù†','Ø´ÙˆØ´ØªØ±'],
  'ÙØ§Ø±Ø³':                     ['Ø´ÛŒØ±Ø§Ø²','Ù…Ø±ÙˆØ¯Ø´Øª','Ø¬Ù‡Ø±Ù…','Ú©Ø§Ø²Ø±ÙˆÙ†','Ø¯Ø§Ø±Ø§Ø¨','ÙØ³Ø§','Ù„Ø§Ø±Ø³ØªØ§Ù†'],
  'Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ':              ['Ù…Ø´Ù‡Ø¯','Ù†ÛŒØ´Ø§Ø¨ÙˆØ±','Ø³Ø¨Ø²ÙˆØ§Ø±','ØªØ±Ø¨Øª Ø­ÛŒØ¯Ø±ÛŒÙ‡','Ù‚ÙˆÚ†Ø§Ù†','Ú¯Ù†Ø§Ø¨Ø§Ø¯','Ø¨Ø¬Ù†ÙˆØ±Ø¯'],
  'Ù…Ø§Ø²Ù†Ø¯Ø±Ø§Ù†':                  ['Ø³Ø§Ø±ÛŒ','Ø¢Ù…Ù„','Ø¨Ø§Ø¨Ù„','Ø¨Ø§Ø¨Ù„Ø³Ø±','Ù†ÙˆØ´Ù‡Ø±','ØªÙ†Ú©Ø§Ø¨Ù†','Ú†Ø§Ù„ÙˆØ³','Ø±Ø§Ù…Ø³Ø±'],
  'Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø´Ø±Ù‚ÛŒ':           ['ØªØ¨Ø±ÛŒØ²','Ù…Ø±Ø§ØºÙ‡','Ø§Ù‡Ø±','Ù…Ø±Ù†Ø¯','Ù…ÛŒØ§Ù†Ù‡','Ø³Ø±Ø§Ø¨','Ø¨Ù†Ø§Ø¨','Ù…Ù„Ú©Ø§Ù†'],
  'Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† ØºØ±Ø¨ÛŒ':           ['Ø§Ø±ÙˆÙ…ÛŒÙ‡','Ø®ÙˆÛŒ','Ù…Ù‡Ø§Ø¨Ø§Ø¯','Ø¨ÙˆÚ©Ø§Ù†','Ù…ÛŒØ§Ù†Ø¯ÙˆØ¢Ø¨','Ø³Ù„Ù…Ø§Ø³','Ù†Ù‚Ø¯Ù‡'],
  'Ú©Ø±Ù…Ø§Ù†Ø´Ø§Ù‡':                 ['Ú©Ø±Ù…Ø§Ù†Ø´Ø§Ù‡','Ø§Ø³Ù„Ø§Ù…â€ŒØ¢Ø¨Ø§Ø¯ ØºØ±Ø¨','Ù‡Ø±Ø³ÛŒÙ†','Ø³Ø±Ù¾Ù„ Ø°Ù‡Ø§Ø¨','Ú©Ù†Ú¯Ø§ÙˆØ±','ØµØ­Ù†Ù‡'],
  'Ú¯ÛŒÙ„Ø§Ù†':                    ['Ø±Ø´Øª','Ø§Ù†Ø²Ù„ÛŒ','Ù„Ø§Ù‡ÛŒØ¬Ø§Ù†','Ø¢Ø³ØªØ§Ø±Ø§','Ø±ÙˆØ¯Ø³Ø±','Ù„Ù†Ú¯Ø±ÙˆØ¯','ØªØ§Ù„Ø´'],
  'Ø§Ù„Ø¨Ø±Ø²':                    ['Ú©Ø±Ø¬','ÙØ±Ø¯ÛŒØ³','Ù†Ø¸Ø±Ø¢Ø¨Ø§Ø¯','Ø³Ø§ÙˆØ¬Ø¨Ù„Ø§Øº','Ø§Ø´ØªÙ‡Ø§Ø±Ø¯','Ø·Ø§Ù„Ù‚Ø§Ù†'],
  'Ú©Ø±Ù…Ø§Ù†':                    ['Ú©Ø±Ù…Ø§Ù†','Ø±ÙØ³Ù†Ø¬Ø§Ù†','Ø³ÛŒØ±Ø¬Ø§Ù†','Ø¬ÛŒØ±ÙØª','Ø²Ø±Ù†Ø¯','Ø¨Ù…','Ø¨Ø§ÙØª'],
  'Ø³ÛŒØ³ØªØ§Ù† Ùˆ Ø¨Ù„ÙˆÚ†Ø³ØªØ§Ù†':       ['Ø²Ø§Ù‡Ø¯Ø§Ù†','Ø²Ø§Ø¨Ù„','Ú†Ø§Ø¨Ù‡Ø§Ø±','Ø§ÛŒØ±Ø§Ù†Ø´Ù‡Ø±','Ø³Ø±Ø§ÙˆØ§Ù†','Ø®Ø§Ø´'],
  'Ù‡Ø±Ù…Ø²Ú¯Ø§Ù†':                  ['Ø¨Ù†Ø¯Ø± Ø¹Ø¨Ø§Ø³','Ù…ÛŒÙ†Ø§Ø¨','Ù‚Ø´Ù…','Ø¨Ù†Ø¯Ø± Ù„Ù†Ú¯Ù‡','Ø±ÙˆØ¯Ø§Ù†','Ø¬Ø§Ø³Ú©'],
  'Ø¨ÙˆØ´Ù‡Ø±':                    ['Ø¨ÙˆØ´Ù‡Ø±','Ø¯Ø´ØªØ³ØªØ§Ù†','Ú©Ù†Ú¯Ø§Ù†','Ú¯Ù†Ø§ÙˆÙ‡','Ø¯ÛŒÙ„Ù…','ØªÙ†Ú¯Ø³ØªØ§Ù†'],
  'Ù‡Ù…Ø¯Ø§Ù†':                    ['Ù‡Ù…Ø¯Ø§Ù†','Ù…Ù„Ø§ÛŒØ±','Ù†Ù‡Ø§ÙˆÙ†Ø¯','Ø§Ø³Ø¯Ø¢Ø¨Ø§Ø¯','ØªÙˆÛŒØ³Ø±Ú©Ø§Ù†','Ø¨Ù‡Ø§Ø±'],
  'Ù‚Ù…':                       ['Ù‚Ù…','Ø¬Ø¹ÙØ±ÛŒÙ‡'],
  'Ø²Ù†Ø¬Ø§Ù†':                    ['Ø²Ù†Ø¬Ø§Ù†','Ø§Ø¨Ù‡Ø±','Ø®Ø±Ù…Ø¯Ø±Ù‡','Ù‚ÛŒØ¯Ø§Ø±'],
  'Ø³Ù…Ù†Ø§Ù†':                    ['Ø³Ù…Ù†Ø§Ù†','Ø´Ø§Ù‡Ø±ÙˆØ¯','Ú¯Ø±Ù…Ø³Ø§Ø±','Ø¯Ø§Ù…ØºØ§Ù†','Ù…Ù‡Ø¯ÛŒØ´Ù‡Ø±'],
  'Ú¯Ù„Ø³ØªØ§Ù†':                   ['Ú¯Ø±Ú¯Ø§Ù†','Ú¯Ù†Ø¨Ø¯ Ú©Ø§ÙˆÙˆØ³','Ø¢Ù‚â€ŒÙ‚Ù„Ø§','Ú©Ø±Ø¯Ú©ÙˆÛŒ','Ø¨Ù†Ø¯Ø± Ú¯Ø²'],
  'Ø®Ø±Ø§Ø³Ø§Ù† Ø´Ù…Ø§Ù„ÛŒ':             ['Ø¨Ø¬Ù†ÙˆØ±Ø¯','Ø´ÛŒØ±ÙˆØ§Ù†','Ø§Ø³ÙØ±Ø§ÛŒÙ†','Ø¬Ø§Ø¬Ø±Ù…','ÙØ§Ø±ÙˆØ¬'],
  'Ø®Ø±Ø§Ø³Ø§Ù† Ø¬Ù†ÙˆØ¨ÛŒ':             ['Ø¨ÛŒØ±Ø¬Ù†Ø¯','Ù‚Ø§ÛŒÙ†','Ø·Ø¨Ø³','Ø³Ø±Ø§ÛŒØ§Ù†','Ø¨Ø´Ø±ÙˆÛŒÙ‡'],
  'Ø§Ø±Ø¯Ø¨ÛŒÙ„':                   ['Ø§Ø±Ø¯Ø¨ÛŒÙ„','Ù¾Ø§Ø±Ø³â€ŒØ¢Ø¨Ø§Ø¯','Ù…Ø´Ú¯ÛŒÙ†â€ŒØ´Ù‡Ø±','Ø®Ù„Ø®Ø§Ù„','Ú¯Ø±Ù…ÛŒ'],
  'Ø§ÛŒÙ„Ø§Ù…':                    ['Ø§ÛŒÙ„Ø§Ù…','Ø¯Ù‡Ù„Ø±Ø§Ù†','Ø¢Ø¨Ø¯Ø§Ù†Ø§Ù†','Ù…Ù‡Ø±Ø§Ù†','Ø´ÛŒØ±ÙˆØ§Ù† Ú†Ø±Ø¯Ø§ÙˆÙ„'],
  'Ù„Ø±Ø³ØªØ§Ù†':                   ['Ø®Ø±Ù…â€ŒØ¢Ø¨Ø§Ø¯','Ø¨Ø±ÙˆØ¬Ø±Ø¯','Ø§Ù„ÛŒÚ¯ÙˆØ¯Ø±Ø²','Ø¯ÙˆØ±ÙˆØ¯','Ù†ÙˆØ±Ø¢Ø¨Ø§Ø¯'],
  'Ú†Ù‡Ø§Ø±Ù…Ø­Ø§Ù„ Ùˆ Ø¨Ø®ØªÛŒØ§Ø±ÛŒ':      ['Ø´Ù‡Ø±Ú©Ø±Ø¯','Ø¨Ø±ÙˆØ¬Ù†','ÙØ§Ø±Ø³Ø§Ù†','Ù„Ø±Ø¯Ú¯Ø§Ù†','Ø§Ø±Ø¯Ù„'],
  'Ú©Ù‡Ú¯ÛŒÙ„ÙˆÛŒÙ‡ Ùˆ Ø¨ÙˆÛŒØ±Ø§Ø­Ù…Ø¯':    ['ÛŒØ§Ø³ÙˆØ¬','Ú¯Ú†Ø³Ø§Ø±Ø§Ù†','Ø¯ÙˆÚ¯Ù†Ø¨Ø¯Ø§Ù†','Ù„ÛŒÚ©Ú©'],
  'Ú©Ø±Ø¯Ø³ØªØ§Ù†':                  ['Ø³Ù†Ù†Ø¯Ø¬','Ø³Ù‚Ø²','Ù…Ø±ÛŒÙˆØ§Ù†','Ø¨Ø§Ù†Ù‡','Ù‚Ø±ÙˆÙ‡','Ø¯ÛŒÙˆØ§Ù†Ø¯Ø±Ù‡'],
  'Ù…Ø±Ú©Ø²ÛŒ':                    ['Ø§Ø±Ø§Ú©','Ø³Ø§ÙˆÙ‡','Ø®Ù…ÛŒÙ†','ØªÙØ±Ø´','Ù…Ø­Ù„Ø§Øª','Ø¯Ù„ÛŒØ¬Ø§Ù†'],
  'Ù‚Ø²ÙˆÛŒÙ†':                    ['Ù‚Ø²ÙˆÛŒÙ†','ØªØ§Ú©Ø³ØªØ§Ù†','Ø¢Ø¨ÛŒÚ©','Ø§Ù„Ø¨Ø±Ø²','Ø¨ÙˆØ¦ÛŒÙ†â€ŒØ²Ù‡Ø±Ø§'],
  'ÛŒØ²Ø¯':                      ['ÛŒØ²Ø¯','Ù…ÛŒØ¨Ø¯','Ø§Ø±Ø¯Ú©Ø§Ù†','Ø¨Ø§ÙÙ‚','ØªÙØª','Ù…Ù‡Ø±ÛŒØ²']
};

function updateCities() {
  const province = document.getElementById('province').value;
  const cityInput = document.getElementById('city');
  const dataList = document.getElementById('cityList');
  dataList.innerHTML = '';
  cityInput.value = '';
  const cities = PROVINCE_CITIES[province] || [];
  cities.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    dataList.appendChild(opt);
  });
  if (cities.length) cityInput.placeholder = 'Ù…Ø«Ø§Ù„: ' + cities[0];
  else cityInput.placeholder = 'Ù†Ø§Ù… Ø´Ù‡Ø± ÛŒØ§ Ø±ÙˆØ³ØªØ§';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FILE UPLOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let fileBase64 = null;

function handleFileUpload(event) {
  const file = event.target.files[0];
  if (!file) return;
  if (file.size > 5 * 1024 * 1024) {
    alert('Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ù†Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ûµ Ù…Ú¯Ø§Ø¨Ø§ÛŒØª Ø¨Ø§Ø´Ø¯.');
    event.target.value = '';
    return;
  }
  const reader = new FileReader();
  reader.onload = function(e) {
    fileBase64 = e.target.result;
    const preview = document.getElementById('filePreview');
    const img = document.getElementById('filePreviewImg');
    const name = document.getElementById('filePreviewName');
    preview.style.display = 'block';
    if (file.type.startsWith('image/')) {
      img.src = fileBase64;
      img.style.display = 'block';
    } else {
      img.style.display = 'none';
    }
    name.textContent = 'ğŸ“ ' + sanitizeHTML(file.name);
    document.getElementById('fileUploadText').style.opacity = '0.4';
  };
  reader.readAsDataURL(file);
}

function clearFile() {
  fileBase64 = null;
  document.getElementById('fileInput').value = '';
  document.getElementById('filePreview').style.display = 'none';
  document.getElementById('fileUploadText').style.opacity = '1';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GPS LOCATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getGPS() {
  const btn = document.getElementById('getLocation');
  const coords = document.getElementById('gpsCoords');
  if (!navigator.geolocation) {
    coords.textContent = 'âš ï¸ Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² GPS Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.';
    coords.style.display = 'block';
    coords.style.color = '#ff5555';
    return;
  }
  btn.textContent = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª...';
  btn.disabled = true;
  navigator.geolocation.getCurrentPosition(
    function(pos) {
      const lat = pos.coords.latitude.toFixed(6);
      const lng = pos.coords.longitude.toFixed(6);
      document.getElementById('gpsLat').value = lat;
      document.getElementById('gpsLng').value = lng;
      coords.textContent = `ğŸ“ Lat: ${lat}  |  Lng: ${lng}`;
      coords.style.display = 'block';
      coords.style.color = '#00ff88';
      btn.innerHTML = '<span>âœ…</span> Ù…ÙˆÙ‚Ø¹ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯';
      btn.disabled = false;
    },
    function(err) {
      coords.textContent = 'âš ï¸ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ú©Ø§Ù†ÛŒ Ø±Ø¯ Ø´Ø¯ ÛŒØ§ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª.';
      coords.style.display = 'block';
      coords.style.color = '#ffaa00';
      btn.innerHTML = '<span>ğŸ“</span> Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†';
      btn.disabled = false;
    },
    { enableHighAccuracy: true, timeout: 10000 }
  );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CAPTCHA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let captchaA = 0, captchaB = 0;

function generateCaptcha() {
  captchaA = Math.floor(Math.random() * 9) + 1;
  captchaB = Math.floor(Math.random() * 9) + 1;
  document.getElementById('captchaQuestion').textContent = captchaA + ' + ' + captchaB;
  document.getElementById('captchaAnswer').value = '';
}
generateCaptcha();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRACKING CODE GENERATOR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function generateTrackingCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let code = '';
  for (let i = 0; i < 8; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM VALIDATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showError(id, msg) {
  const el = document.getElementById('err-' + id);
  const input = document.getElementById(id);
  if (el) { el.textContent = msg; el.classList.add('visible'); }
  if (input) input.classList.add('error');
}

function clearError(id) {
  const el = document.getElementById('err-' + id);
  const input = document.getElementById(id);
  if (el) { el.textContent = ''; el.classList.remove('visible'); }
  if (input) input.classList.remove('error');
}

function clearAllErrors() {
  ['fullName','phone','email','province','threatType','description','captcha'].forEach(clearError);
}

function liveValidateDesc() {
  const val = document.getElementById('description').value;
  const count = document.getElementById('descCount');
  count.textContent = val.length + ' / 1000';
  if (val.length > 1000) count.style.color = '#ff5555';
  else if (val.length >= 20) count.style.color = '#00ff88';
  else count.style.color = '#555';
}

function validateForm() {
  clearAllErrors();
  let valid = true;

  const isAnon = document.getElementById('anonCheck').checked;
  const province = document.getElementById('province').value;
  const threatType = document.getElementById('threatType').value;
  const description = document.getElementById('description').value.trim();
  const captchaAnswer = parseInt(document.getElementById('captchaAnswer').value, 10);

  if (!isAnon) {
    const phone = document.getElementById('phone').value.trim();
    const email = document.getElementById('email').value.trim();
    if (phone && !/^(09|\+989)\d{9}$/.test(phone.replace(/\s/g,''))) {
      showError('phone', 'ÙØ±Ù…Øª Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª (Ù…Ø«Ø§Ù„: 09xxxxxxxxx)');
      valid = false;
    }
    if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      showError('email', 'ÙØ±Ù…Øª Ø¢Ø¯Ø±Ø³ Ø§ÛŒÙ…ÛŒÙ„ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª');
      valid = false;
    }
  }

  if (!province) {
    showError('province', 'Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø³ØªØ§Ù† Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
    valid = false;
  }

  if (!threatType) {
    showError('threatType', 'Ø§Ù†ØªØ®Ø§Ø¨ Ù†ÙˆØ¹ ØªÙ‡Ø¯ÛŒØ¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª');
    valid = false;
  }

  if (description.length < 20) {
    showError('description', 'ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û²Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
    valid = false;
  } else if (description.length > 1000) {
    showError('description', 'ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² Û±Û°Û°Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯');
    valid = false;
  }

  if (isNaN(captchaAnswer) || captchaAnswer !== captchaA + captchaB) {
    showError('captcha', 'Ù¾Ø§Ø³Ø® Ù…Ø¹Ø§Ø¯Ù„Ù‡ Ø±ÛŒØ§Ø¶ÛŒ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª');
    valid = false;
  }

  return valid;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function submitReport(event) {
  event.preventDefault();
  if (!validateForm()) return;

  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.textContent = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø«Ø¨Øª...';

  const isAnon = document.getElementById('anonCheck').checked;
  const urgency = document.querySelector('input[name="urgency"]:checked').value;
  const trackingCode = generateTrackingCode();
  const now = new Date();

  const report = {
    id:           trackingCode,
    date:         now.toISOString(),
    dateJalali:   formatJalali(now),
    anonymous:    isAnon,
    fullName:     isAnon ? '' : document.getElementById('fullName').value.trim(),
    phone:        isAnon ? '' : document.getElementById('phone').value.trim(),
    email:        isAnon ? '' : document.getElementById('email').value.trim(),
    province:     document.getElementById('province').value,
    city:         document.getElementById('city').value.trim(),
    threatType:   document.getElementById('threatType').value,
    threatLabel:  document.getElementById('threatType').options[document.getElementById('threatType').selectedIndex].text,
    urgency:      urgency,
    obsDate:      document.getElementById('obsDate').value,
    description:  document.getElementById('description').value.trim(),
    lat:          document.getElementById('gpsLat').value,
    lng:          document.getElementById('gpsLng').value,
    file:         fileBase64,
    status:       'submitted',
    statusHistory:[{status:'submitted', date: now.toISOString(), note:'Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯'}],
    adminNotes:   ''
  };

  // Persist to localStorage
  try {
    const existing = JSON.parse(localStorage.getItem('pbdo_reports') || '[]');
    existing.push(report);
    localStorage.setItem('pbdo_reports', JSON.stringify(existing));
  } catch(e) {
    console.warn('localStorage write failed:', e);
  }

  // Show success
  setTimeout(function() {
    document.getElementById('reportFormCard').style.display = 'none';
    const sc = document.getElementById('successCard');
    sc.classList.add('visible');
    document.getElementById('successCode').textContent = trackingCode;
    sc.scrollIntoView({ behavior: 'smooth', block: 'start' });
    generateCaptcha();
  }, 600);
}

function resetForm() {
  document.getElementById('reportForm').reset();
  document.getElementById('anonCheck').checked = false;
  document.getElementById('personalFields').style.display = 'block';
  clearAllErrors();
  clearFile();
  document.getElementById('gpsCoords').style.display = 'none';
  document.getElementById('gpsLat').value = '';
  document.getElementById('gpsLng').value = '';
  document.getElementById('descCount').textContent = '0 / 1000';
  document.getElementById('descCount').style.color = '#555';
  document.getElementById('getLocation').innerHTML = '<span>ğŸ“</span> Ø¯Ø±ÛŒØ§ÙØª Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù†';
  document.getElementById('getLocation').disabled = false;
  generateCaptcha();

  document.getElementById('successCard').classList.remove('visible');
  const card = document.getElementById('reportFormCard');
  card.style.display = 'block';
  card.scrollIntoView({ behavior: 'smooth', block: 'start' });

  const btn = document.getElementById('submitBtn');
  btn.disabled = false;
  btn.textContent = 'ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ú¯Ø²Ø§Ø±Ø´';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRACK REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const STATUS_STEPS = [
  { key: 'submitted',   label: 'Ø«Ø¨Øª Ø´Ø¯Ù‡' },
  { key: 'reviewing',   label: 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ' },
  { key: 'confirmed',   label: 'ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡' },
  { key: 'actioned',    label: 'Ø§Ù‚Ø¯Ø§Ù… Ø´Ø¯Ù‡' },
  { key: 'closed',      label: 'Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡' }
];

const STATUS_ORDER = STATUS_STEPS.map(s => s.key);

function trackReport() {
  const code = document.getElementById('trackingInput').value.trim().toUpperCase();
  const resultEl = document.getElementById('trackResult');

  if (!code || code.length < 4) {
    resultEl.innerHTML = '<div class="not-found"><div class="icon">âš ï¸</div><p>Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</p></div>';
    return;
  }

  let reports = [];
  try {
    reports = JSON.parse(localStorage.getItem('pbdo_reports') || '[]');
  } catch(e) { reports = []; }

  const report = reports.find(r => r.id === code);

  if (!report) {
    resultEl.innerHTML = `
      <div class="not-found">
        <div class="icon">ğŸ”</div>
        <p style="font-size:15px;font-weight:700;color:#888;margin-bottom:6px;">Ú¯Ø²Ø§Ø±Ø´ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ú©Ø¯ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>
        <p style="font-size:13px;color:#555;">Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Ú©Ø¯ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ Ø±Ø§ Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.</p>
      </div>`;
    return;
  }

  const currentIdx = STATUS_ORDER.indexOf(report.status);
  const urgencyMap = { normal: ['badge-green','Ø¹Ø§Ø¯ÛŒ'], urgent: ['badge-yellow','ÙÙˆØ±ÛŒ'], critical: ['badge-red','Ø¨Ø­Ø±Ø§Ù†ÛŒ'] };
  const [badgeClass, urgencyLabel] = urgencyMap[report.urgency] || ['badge-blue', report.urgency];

  const timelineHTML = STATUS_STEPS.map((step, i) => {
    let dotClass = '';
    let labelClass = '';
    let dateHTML = '';
    if (i < currentIdx) {
      dotClass = 'done'; labelClass = 'done';
      const hist = (report.statusHistory || []).find(h => h.status === step.key);
      if (hist) dateHTML = `<div class="step-date">${sanitizeHTML(hist.date ? formatJalali(new Date(hist.date)) : '')}</div>`;
    } else if (i === currentIdx) {
      dotClass = 'current'; labelClass = 'current';
      dateHTML = `<div class="step-date" style="color:#ffaa00;">ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ</div>`;
    }
    return `
      <div class="timeline-step">
        <div class="step-dot ${dotClass}"></div>
        <div class="step-info">
          <div class="step-label ${labelClass}">${sanitizeHTML(step.label)}</div>
          ${dateHTML}
        </div>
      </div>`;
  }).join('');

  const notesHTML = report.adminNotes
    ? `<div class="admin-notes"><strong style="color:#00ff88;">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª Ú©Ø§Ø±Ø´Ù†Ø§Ø³:</strong><br/>${sanitizeHTML(report.adminNotes)}</div>`
    : '';

  resultEl.innerHTML = `
    <div class="report-detail">
      <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;margin-bottom:16px;">
        <div>
          <div style="font-size:13px;color:#555;margin-bottom:4px;">Ø´Ù†Ø§Ø³Ù‡ Ú¯Ø²Ø§Ø±Ø´</div>
          <div style="font-family:'Courier New',monospace;font-size:1.2rem;font-weight:900;color:#00ff88;letter-spacing:2px;">${sanitizeHTML(report.id)}</div>
        </div>
        <span class="badge ${badgeClass}">${sanitizeHTML(urgencyLabel)}</span>
      </div>
      <div class="detail-row"><span class="detail-label">ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª:</span><span class="detail-value">${sanitizeHTML(report.dateJalali || new Date(report.date).toLocaleDateString('fa-IR'))}</span></div>
      <div class="detail-row"><span class="detail-label">Ø§Ø³ØªØ§Ù†:</span><span class="detail-value">${sanitizeHTML(report.province)}${report.city ? ' â€” ' + sanitizeHTML(report.city) : ''}</span></div>
      <div class="detail-row"><span class="detail-label">Ù†ÙˆØ¹ ØªÙ‡Ø¯ÛŒØ¯:</span><span class="detail-value">${sanitizeHTML(report.threatLabel || report.threatType)}</span></div>
      <div class="detail-row"><span class="detail-label">Ø§Ø±Ø³Ø§Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡:</span><span class="detail-value">${report.anonymous ? 'ğŸ•µï¸ Ù†Ø§Ø´Ù†Ø§Ø³' : sanitizeHTML(report.fullName || 'â€”')}</span></div>
    </div>
    <div class="report-detail">
      <div style="font-size:13px;font-weight:700;color:#888;margin-bottom:16px;">ÙˆØ¶Ø¹ÛŒØª Ù¾ÛŒÚ¯ÛŒØ±ÛŒ</div>
      <div class="status-timeline" role="list" aria-label="Ù…Ø±Ø§Ø­Ù„ ÙˆØ¶Ø¹ÛŒØª Ú¯Ø²Ø§Ø±Ø´">
        ${timelineHTML}
      </div>
      ${notesHTML}
    </div>`;
}

/* Allow Enter key in tracking input */
document.getElementById('trackingInput').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') trackReport();
});

/* Set today as default observation date */
(function() {
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('obsDate').value = today;
})();
</script>

</body>
</html>
