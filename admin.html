<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/> 
  <title>PBDO | Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;700;900&display=swap" rel="stylesheet"/>
  <style>
    *{font-family:'Vazirmatn',sans-serif;}
    body{background:#0a0f1e;color:#e0e8ff;margin:0;}
    .neon-blue{color:#00f0ff;text-shadow:0 0 8px #00f0ff;}
    .card{background:#0d1528;border:1px solid #00f0ff33;border-radius:12px;padding:20px;}
    .btn-primary{background:linear-gradient(135deg,#00f0ff,#0066ff);color:#000;font-weight:700;padding:10px 24px;border-radius:8px;border:none;cursor:pointer;transition:all .3s;width:100%;}
    .btn-sm{padding:6px 14px;border-radius:6px;border:none;cursor:pointer;font-size:12px;font-family:inherit;}
    .btn-green{background:#39ff1422;color:#39ff14;border:1px solid #39ff14;}
    .btn-red{background:#ff003c22;color:#ff003c;border:1px solid #ff003c;}
    .btn-yellow{background:#ffd70022;color:#ffd700;border:1px solid #ffd700;}
    input,select,textarea{background:#0d1528;border:1px solid #00f0ff44;color:#e0e8ff;padding:10px 14px;border-radius:8px;width:100%;box-sizing:border-box;font-family:inherit;}
    input:focus,select:focus{outline:none;border-color:#00f0ff;}
    table{width:100%;border-collapse:collapse;}
    th{background:#0a0f1e;color:#00f0ff;padding:12px;text-align:right;border-bottom:1px solid #00f0ff33;font-size:13px;}
    td{padding:10px 12px;border-bottom:1px solid #ffffff11;font-size:13px;}
    .status-green{background:#39ff1422;color:#39ff14;border:1px solid #39ff14;padding:2px 10px;border-radius:20px;font-size:11px;}
    .status-yellow{background:#ffd70022;color:#ffd700;border:1px solid #ffd700;padding:2px 10px;border-radius:20px;font-size:11px;}
    .status-red{background:#ff003c22;color:#ff003c;border:1px solid #ff003c;padding:2px 10px;border-radius:20px;font-size:11px;}
    .sidebar{background:#060c1a;border-left:1px solid #00f0ff22;min-height:100vh;width:220px;flex-shrink:0;}
    .nav-item{padding:12px 16px;cursor:pointer;border-radius:8px;margin:2px 8px;font-size:14px;transition:all .2s;}
    .nav-item:hover,.nav-item.active{background:#00f0ff22;color:#00f0ff;}
  </style>
</head>
<body>

<div id="loginPage" class="min-h-screen flex items-center justify-center px-4">
  <div class="card w-full max-w-sm">
    <div class="text-center mb-8">
      <div class="text-4xl mb-3">ğŸ›¡ï¸</div>
      <h1 class="text-2xl font-black neon-blue">PBDO Admin</h1>
      <p class="text-gray-400 text-sm mt-1">Ø³Ø§Ù…Ø§Ù†Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø¯Ø§ÙÙ†Ø¯ Ø²ÛŒØ³ØªÛŒ</p>
    </div>
    <div id="loginError" class="hidden bg-red-900/30 border border-red-500 text-red-400 text-sm p-3 rounded-lg mb-4 text-center">
      âŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª
    </div>
    <div class="mb-4">
      <label class="text-sm text-gray-400 block mb-2">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
      <input type="text" id="loginUser" placeholder="username" dir="ltr"/>
    </div>
    <div class="mb-6">
      <label class="text-sm text-gray-400 block mb-2">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
      <input type="password" id="loginPass" placeholder="password" dir="ltr" onkeydown="if(event.key==='Enter')doLogin()"/>
    </div>
    <button onclick="doLogin()" class="btn-primary mb-4">ğŸ” ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…</button>
    <div class="text-xs text-gray-600 text-center mt-4 border-t border-gray-800 pt-4">
      <p class="mb-1">ğŸ”µ Super Admin: superadmin / pbdo@super2025</p>
      <p class="mb-1">ğŸŸ¡ Regional: admin_west / pbdo@west2025</p>
      <p>ğŸŸ¢ Operator: operator1 / pbdo@op2025</p>
    </div>
  </div>
</div>

<div id="dashboard" class="hidden flex min-h-screen">
  <div class="sidebar flex flex-col py-6">
    <div class="text-center mb-8 px-4">
      <div class="text-2xl font-black neon-blue">ğŸ›¡ï¸ PBDO</div>
      <div id="sideRole" class="text-xs text-gray-400 mt-1"></div>
    </div>
    <nav class="flex-1">
      <div class="nav-item active" onclick="showSection('overview',this)">ğŸ“Š Ù†Ù…Ø§ÛŒ Ú©ï¿½ï¿½ÛŒ</div>
      <div id="navUsers" class="nav-item hidden" onclick="showSection('users',this)">ğŸ‘¥ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</div>
      <div id="navReports" class="nav-item hidden" onclick="showSection('reports',this)">ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§</div>
      <div id="navSubmit" class="nav-item hidden" onclick="showSection('submit',this)">â• Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´</div>
      <div id="navRaw" class="nav-item hidden" onclick="showSection('raw',this)">ğŸ“¡ Ø«Ø¨Øª Ø¯Ø§Ø¯Ù‡ Ø®Ø§Ù…</div>
      <div id="navLogs" class="nav-item hidden" onclick="showSection('logs',this)">ğŸ” Ù„Ø§Ú¯ Ø³ÛŒØ³ØªÙ…</div>
    </nav>
    <div class="px-4 mt-4">
      <a href="index.html" class="block text-center text-gray-500 text-xs mb-3 hover:text-cyan-400">ğŸŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø³Ø§ÛŒØª</a>
      <button onclick="doLogout()" class="block w-full text-center text-red-400 text-sm p-2 rounded-lg border border-red-900 hover:bg-red-900/20">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <div class="flex-1 overflow-y-auto p-6">
    <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
      <div>
        <h1 class="text-2xl font-black neon-blue">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª PBDO</h1>
        <p id="welcomeMsg" class="text-gray-400 text-sm"></p>
      </div>
      <div class="flex items-center gap-3">
        <div class="text-xs text-gray-500" id="currentTime"></div>
        <div id="roleTag" class="text-xs px-3 py-1 rounded-full border"></div>
      </div>
    </div>

    <div id="sectionOverview">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div class="card text-center"><div class="text-3xl font-black neon-blue">Û³</div><div class="text-gray-400 text-sm mt-1">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙØ¹Ø§Ù„</div></div>
        <div class="card text-center"><div class="text-3xl font-black" style="color:#39ff14">Û±Ûµ</div><div class="text-gray-400 text-sm mt-1">Ú¯Ø²Ø§Ø±Ø´ Ø§Ù…Ø±ÙˆØ²</div></div>
        <div class="card text-center"><div class="text-3xl font-black" style="color:#ffd700">Û³</div><div class="text-gray-400 text-sm mt-1">Ù‡Ø´Ø¯Ø§Ø± ÙØ¹Ø§Ù„</div></div>
        <div class="card text-center"><div class="text-3xl font-black" style="color:#ff003c">Û²</div><div class="text-gray-400 text-sm mt-1">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯</div></div>
      </div>
      <div class="card">
        <h3 class="font-bold mb-4 neon-blue">ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯</h3>
        <div id="pendingReports"></div>
      </div>
    </div>

    <div id="sectionUsers" class="hidden">
      <div class="card overflow-x-auto">
        <h3 class="font-bold mb-4 neon-blue">ğŸ‘¥ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h3>
        <table>
          <thead><tr><th>Ù†Ø§Ù…</th><th>Ù†Ù‚Ø´</th><th>Ø¢Ø®Ø±ÛŒÙ† ÙˆØ±ÙˆØ¯</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th></tr></thead>
          <tbody>
            <tr><td class="font-bold">Ù…Ø¯ÛŒØ± Ø§Ø±Ø´Ø¯</td><td><span class="status-red">Super Admin</span></td><td class="text-xs text-gray-400">Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù†</td><td><span class="status-green">ÙØ¹Ø§Ù„</span></td><td><button class="btn-sm btn-yellow">ÙˆÛŒØ±Ø§ÛŒØ´</button></td></tr>
            <tr><td class="font-bold">Ù…Ø¯ÛŒØ± Ù…Ù†Ø·Ù‚Ù‡ ØºØ±Ø¨</td><td><span class="status-yellow">Regional Admin</span></td><td class="text-xs text-gray-400">Û² Ø³Ø§Ø¹Øª Ù¾ÛŒØ´</td><td><span class="status-green">ÙØ¹Ø§Ù„</span></td><td><button class="btn-sm btn-yellow mr-2">ÙˆÛŒØ±Ø§ÛŒØ´</button><button class="btn-sm btn-red">ØºÛŒØ±ÙØ¹Ø§Ù„</button></td></tr>
            <tr><td class="font-bold">Ø§Ù¾Ø±Ø§ØªÙˆØ± Û±</td><td><span class="status-green">Operator</span></td><td class="text-xs text-gray-400">Û± Ø±ÙˆØ² Ù¾ÛŒØ´</td><td><span class="status-green">ÙØ¹Ø§Ù„</span></td><td><button class="btn-sm btn-yellow mr-2">ÙˆÛŒØ±Ø§ÛŒØ´</button><button class="btn-sm btn-red">ØºÛŒØ±ÙØ¹Ø§Ù„</button></td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div id="sectionReports" class="hidden">
      <div class="card overflow-x-auto">
        <h3 class="font-bold mb-4 neon-blue">ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒØ´</h3>
        <div id="reportsTable"></div>
      </div>
    </div>

    <div id="sectionSubmit" class="hidden">
      <div class="card max-w-lg">
        <h3 class="font-bold mb-6 neon-blue">â• Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´ Ù¾Ø§ÛŒØ´ Ø¬Ø¯ÛŒØ¯</h3>
        <form onsubmit="submitReport(event)">
          <div class="mb-4"><label class="text-sm text-gray-400 block mb-2">Ø§Ø³ØªØ§Ù†</label>
            <select id="repProvince" required>
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨ Ø§Ø³ØªØ§Ù†</option>
              <option>ØªÙ‡Ø±Ø§Ù†</option><option>Ø§ØµÙÙ‡ï¿½ï¿½Ù†</option><option>Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ</option><option>ÙØ§Ø±Ø³</option>
              <option>Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø´Ø±Ù‚ÛŒ</option><option>Ø®ÙˆØ²Ø³ØªØ§Ù†</option><option>Ú¯ÛŒÙ„Ø§Ù†</option><option>Ú©Ø±Ù…Ø§Ù†Ø´Ø§Ù‡</option>
              <option>Ù‚Ù…</option><option>Ù‡Ù…Ø¯Ø§Ù†</option><option>Ù‡Ø±Ù…Ø²Ú¯Ø§Ù†</option><option>Ø§Ù„Ø¨Ø±Ø²</option>
            </select>
          </div>
          <div class="mb-4"><label class="text-sm text-gray-400 block mb-2">Ø´Ù‡Ø±</label><input type="text" id="repCity" required placeholder="Ù†Ø§Ù… Ø´Ù‡Ø±"/></div>
          <div class="mb-4"><label class="text-sm text-gray-400 block mb-2">ÙˆØ¶Ø¹ÛŒØª</label>
            <select id="repStatus" required>
              <option value="">Ø§Ù†ØªØ®Ø§Ø¨ ÙˆØ¶Ø¹ÛŒØª</option>
              <option value="green">ğŸŸ¢ Ø¹Ø§Ø¯ÛŒ</option>
              <option value="yellow">ğŸŸ¡ Ø§Ø­ØªÛŒØ§Ø·</option>
              <option value="red">ğŸ”´ Ù‡Ø´Ø¯Ø§Ø±</option>
            </select>
          </div>
          <div class="mb-6"><label class="text-sm text-gray-400 block mb-2">ØªÙˆØ¶ÛŒØ­Ø§Øª</label><textarea id="repDesc" rows="3" required placeholder="Ø´Ø±Ø­ ÙˆØ¶Ø¹ÛŒØª..."></textarea></div>
          <button type="submit" class="btn-primary">ğŸ“¤ Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´</button>
        </form>
      </div>
    </div>

    <div id="sectionRaw" class="hidden">
      <div class="card max-w-lg">
        <h3 class="font-bold mb-6 neon-blue">ğŸ“¡ Ø«Ø¨Øª Ø¯Ø§Ø¯Ù‡ Ø®Ø§Ù…</h3>
        <form onsubmit="submitRaw(event)">
          <div class="mb-4"><label class="text-sm text-gray-400 block mb-2">Ù†ÙˆØ¹ Ø¯Ø§Ø¯Ù‡</label>
            <select required>
              <option>Ù†Ù…ÙˆÙ†Ù‡ Ù‡ÙˆØ§</option><option>Ù†Ù…ÙˆÙ†Ù‡ Ø¢Ø¨</option><option>Ù†Ù…ÙˆÙ†Ù‡ Ø®Ø§Ú©</option><option>Ù†Ù…ÙˆÙ†Ù‡ Ø¨ÛŒÙˆÙ„ÙˆÚ˜ÛŒÚ©</option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-4">
            <div><label class="text-sm text-gray-400 block mb-2">Ù…Ù‚Ø¯Ø§Ø±</label><input type="number" step="0.01" required placeholder="0.00"/></div>
            <div><label class="text-sm text-gray-400 block mb-2">ÙˆØ§Ø­Ø¯</label>
              <select><option>ppm</option><option>Î¼g/mÂ³</option><option>CFU/mL</option><option>mg/L</option></select>
            </div>
          </div>
          <div class="mb-4"><label class="text-sm text-gray-400 block mb-2">Ù…ÙˆÙ‚Ø¹ÛŒØª</label><input type="text" required placeholder="Ø´Ù‡Ø± / Ù…Ø®ØªØµØ§Øª"/></div>
          <div class="mb-6"><label class="text-sm text-gray-400 block mb-2">ÛŒØ§Ø¯Ø¯Ø§Ø´Øª</label><textarea rows="2" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ø§Ø¶Ø§ÙÛŒ..."></textarea></div>
          <button type="submit" class="btn-primary">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø§Ø¯Ù‡</button>
        </form>
      </div>
    </div>

    <div id="sectionLogs" class="hidden">
      <div class="card overflow-x-auto">
        <div class="flex justify-between items-center mb-4">
          <h3 class="font-bold neon-blue">ğŸ” Ù„Ø§Ú¯ Ø³ÛŒØ³ØªÙ…</h3>
          <button onclick="clearLogs()" class="btn-sm btn-red">Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ</button>
        </div>
        <div id="logsTable"></div>
      </div>
    </div>
  </div>
</div>

<script>
const USERS=[
  {username:'superadmin',password:'pbdo@super2025',role:'super_admin',name:'Ù…Ø¯ÛŒØ± Ø§Ø±Ø´Ø¯'},
  {username:'admin_west',password:'pbdo@west2025',role:'regional_admin',name:'Ù…Ø¯ÛŒØ± Ù…Ù†Ø·Ù‚Ù‡ ØºØ±Ø¨',region:'ØºØ±Ø¨'},
  {username:'operator1',password:'pbdo@op2025',role:'operator',name:'Ø§Ù¾Ø±Ø§ØªÙˆØ± Û±'}
];
let currentUser=null;
const reports=JSON.parse(localStorage.getItem('pbdo_reports')||'[]');

function logAction(user,action,details){
  const logs=JSON.parse(localStorage.getItem('pbdo_logs')||'[]');
  logs.unshift({id:Date.now(),user:user.username,role:user.role,action,details,timestamp:new Date().toLocaleString('fa-IR')});
  localStorage.setItem('pbdo_logs',JSON.stringify(logs.slice(0,100)));
}

function doLogin(){
  const u=document.getElementById('loginUser').value.trim();
  const p=document.getElementById('loginPass').value;
  const found=USERS.find(x=>x.username===u&&x.password===p);
  if(!found){document.getElementById('loginError').classList.remove('hidden');return;}
  currentUser=found;
  document.getElementById('loginError').classList.add('hidden');
  document.getElementById('loginPage').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');
  setupDashboard();
  logAction(found,'ÙˆØ±ÙˆØ¯','ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…');
}

function setupDashboard(){
  document.getElementById('welcomeMsg').textContent='Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ '+currentUser.name;
  document.getElementById('sideRole').textContent=getRoleLabel(currentUser.role);
  const rt=document.getElementById('roleTag');
  if(currentUser.role==='super_admin'){rt.textContent='Super Admin';rt.className='text-xs px-3 py-1 rounded-full border status-red';}
  else if(currentUser.role==='regional_admin'){rt.textContent='Regional Admin';rt.className='text-xs px-3 py-1 rounded-full border status-yellow';}
  else{rt.textContent='Operator';rt.className='text-xs px-3 py-1 rounded-full border status-green';}
  if(currentUser.role==='super_admin'){
    document.getElementById('navUsers').classList.remove('hidden');
    document.getElementById('navReports').classList.remove('hidden');
    document.getElementById('navLogs').classList.remove('hidden');
  } else if(currentUser.role==='regional_admin'){
    document.getElementById('navReports').classList.remove('hidden');
    document.getElementById('navSubmit').classList.remove('hidden');
  } else {
    document.getElementById('navRaw').classList.remove('hidden');
    document.getElementById('navReports').classList.remove('hidden');
  }
  renderPending();renderReports();renderLogs();updateTime();setInterval(updateTime,1000);
}

function getRoleLabel(r){return r==='super_admin'?'Ù…Ø¯ÛŒØ± Ø§Ø±Ø´Ø¯ Ø³ÛŒØ³ØªÙ…':r==='regional_admin'?'Ù…Ø¯ÛŒØ± Ù…Ù†Ø·Ù‚Ù‡â€ŒØ§ÛŒ':'Ø§Ù¾Ø±Ø§ØªÙˆØ±';}
function updateTime(){document.getElementById('currentTime').textContent=new Date().toLocaleString('fa-IR');}

function showSection(s,el){
  ['overview','users','reports','submit','raw','logs'].forEach(x=>{
    const sec=document.getElementById('section'+x.charAt(0).toUpperCase()+x.slice(1));
    if(sec)sec.classList.add('hidden');
  });
  const target=document.getElementById('section'+s.charAt(0).toUpperCase()+s.slice(1));
  if(target)target.classList.remove('hidden');
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  if(el)el.classList.add('active');
}

function renderPending(){
  const pending=reports.filter(r=>!r.approved);
  const el=document.getElementById('pendingReports');
  if(!el)return;
  if(!pending.length){el.innerHTML='<p class="text-gray-500 text-sm text-center py-4">Ú¯Ø²Ø§Ø±Ø´ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ§ÛŒÛŒØ¯ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>';return;}
  el.innerHTML=pending.map((r,i)=>`
    <div class="border border-yellow-900/50 rounded-lg p-4 mb-3">
      <div class="flex justify-between items-start flex-wrap gap-2">
        <div><b>${r.city}</b> - ${r.province} <span class="status-${r.status} mr-2">${r.status==='green'?'ğŸŸ¢ Ø¹Ø§Ø¯ÛŒ':r.status==='yellow'?'ğŸŸ¡ Ø§Ø­ØªÛŒØ§Ø·':'ğŸ”´ Ù‡Ø´Ø¯Ø§Ø±'}</span></div>
        <div class="flex gap-2">
          ${currentUser.role==='super_admin'?`<button class="btn-sm btn-green" onclick="approveReport(${i})">âœ… ØªØ§ÛŒÛŒØ¯</button><button class="btn-sm btn-red" onclick="rejectReport(${i})">âŒ Ø±Ø¯</button>`:''}
        </div>
      </div>
      <p class="text-sm text-gray-400 mt-2">${r.desc}</p>
      <p class="text-xs text-gray-600 mt-1">Ø«Ø¨Øª ØªÙˆØ³Ø·: ${r.by} â€” ${r.time}</p>
    </div>`).join('');
}

function renderReports(){
  const el=document.getElementById('reportsTable');
  if(!el)return;
  const myReports=currentUser.role==='regional_admin'?reports.filter(r=>r.by===currentUser.username):reports;
  if(!myReports.length){el.innerHTML='<p class="text-gray-500 text-sm text-center py-4">Ú¯Ø²Ø§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</p>';return;}
  el.innerHTML='<table><thead><tr><th>Ø´Ù‡Ø±</th><th>Ø§Ø³ØªØ§Ù†</th><th>ÙˆØ¶Ø¹ÛŒØª</th><th>ØªÙˆØ¶ÛŒØ­Ø§Øª</th><th>Ø«Ø¨Øªâ€ŒÚ©Ù†Ù†Ø¯Ù‡</th><th>ØªØ§ÛŒÛŒØ¯</th></tr></thead><tbody>'+
    myReports.map(r=>`<tr><td>${r.city}</td><td>${r.province}</td><td><span class="status-${r.status}">${r.status==='green'?'ğŸŸ¢ Ø¹Ø§Ø¯ÛŒ':r.status==='yellow'?'ğŸŸ¡ Ø§Ø­ØªÛŒØ§Ø·':'ğŸ”´ Ù‡Ø´Ø¯Ø§Ø±'}</span></td><td class="text-sm">${r.desc}</td><td class="text-xs text-gray-400">${r.by}</td><td>${r.approved?'<span class="status-green">âœ…</span>':'<span class="status-yellow">â³</span>'}</td></tr>`).join('')+'</tbody></table>';
}

function renderLogs(){
  const logs=JSON.parse(localStorage.getItem('pbdo_logs')||'[]');
  const el=document.getElementById('logsTable');
  if(!el)return;
  if(!logs.length){el.innerHTML='<p class="text-gray-500 text-sm text-center py-4">Ù„Ø§Ú¯ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</p>';return;}
  el.innerHTML='<table><thead><tr><th>Ú©Ø§Ø±Ø¨Ø±</th><th>Ù†Ù‚Ø´</th><th>Ø¹Ù…Ù„ÛŒØ§Øª</th><th>Ø¬Ø²Ø¦ÛŒØ§Øª</th><th>Ø²Ù…Ø§Ù†</th></tr></thead><tbody>'+
    logs.map(l=>`<tr><td class="font-bold">${l.user}</td><td>${l.role}</td><td>${l.action}</td><td class="text-sm text-gray-400">${l.details}</td><td class="text-xs text-gray-500">${l.timestamp}</td></tr>`).join('')+'</tbody></table>';
}

function clearLogs(){if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ')){localStorage.removeItem('pbdo_logs');renderLogs();}}

function approveReport(i){
  const pending=reports.filter(r=>!r.approved);
  const idx=reports.indexOf(pending[i]);
  reports[idx].approved=true;
  localStorage.setItem('pbdo_reports',JSON.stringify(reports));
  logAction(currentUser,'ØªØ§ÛŒÛŒØ¯ Ú¯Ø²Ø§Ø±Ø´',reports[idx].city+' - '+reports[idx].province);
  renderPending();renderReports();
}

function rejectReport(i){
  const pending=reports.filter(r=>!r.approved);
  const idx=reports.indexOf(pending[i]);
  reports.splice(idx,1);
  localStorage.setItem('pbdo_reports',JSON.stringify(reports));
  logAction(currentUser,'Ø±Ø¯ Ú¯Ø²Ø§Ø±Ø´','Ú¯Ø²Ø§Ø±Ø´ Ø­Ø°Ù Ø´Ø¯');
  renderPending();renderReports();
}

function submitReport(e){
  e.preventDefault();
  const r={province:document.getElementById('repProvince').value,city:document.getElementById('repCity').value,status:document.getElementById('repStatus').value,desc:document.getElementById('repDesc').value,by:currentUser.username,time:new Date().toLocaleString('fa-IR'),approved:false};
  reports.push(r);
  localStorage.setItem('pbdo_reports',JSON.stringify(reports));
  logAction(currentUser,'Ø«Ø¨Øª Ú¯Ø²Ø§Ø±Ø´',r.city+' - '+r.province);
  alert('âœ… Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯');
  e.target.reset();renderReports();renderPending();
}

function submitRaw(e){
  e.preventDefault();
  logAction(currentUser,'Ø«Ø¨Øª Ø¯Ø§Ø¯Ù‡ Ø®Ø§Ù…','Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯ Ø«Ø¨Øª Ø´Ø¯');
  alert('âœ… Ø¯Ø§Ø¯Ù‡ Ø®Ø§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
  e.target.reset();
}

function doLogout(){
  logAction(currentUser,'Ø®Ø±ÙˆØ¬','Ø®Ø±ÙˆØ¬ Ø§Ø² Ø³ÛŒØ³ØªÙ…');
  currentUser=null;
  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('loginPage').classList.remove('hidden');
  document.getElementById('loginUser').value='';
  document.getElementById('loginPass').value='';
}
</script>
</body>
</html>